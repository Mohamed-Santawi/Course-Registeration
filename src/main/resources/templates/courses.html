<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Courses - Course Registration System</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
    <script>
        function enroll(courseId, btn) {
            fetch('/api/courses/enroll', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'courseId=' + courseId
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    btn.parentElement.innerHTML = '<span>Enrolled</span>';
                    document.getElementById('msg').innerHTML = '<span style="color:green">' + data.message + '</span>';
                } else {
                    document.getElementById('msg').innerHTML = '<span style="color:red">' + data.error + '</span>';
                }
            });
        }
    </script>
</head>
<body>
    <h2>Available Courses</h2>
    <div id="msg"></div>
    <table border="1">
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Instructor</th>
                <th>Capacity</th>
                <th>Current Enrollment</th>
                <th>Schedule</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="course : ${courses}">
                <td th:text="${course.title}"></td>
                <td th:text="${course.description}"></td>
                <td th:text="${course.instructor}"></td>
                <td th:text="${course.capacity}"></td>
                <td th:text="${#lists.size(course.enrollments)}"></td>
                <td>
                    <span th:each="schedule : ${course.schedules}">
                        <span th:text="${schedule.dayOfWeek}"></span>
                        <span th:text="${schedule.startTime}"></span> -
                        <span th:text="${schedule.endTime}"></span>
                        <span th:text="${schedule.location}"></span><br/>
                    </span>
                </td>
                <td>
                    <span th:if="${#lists.contains(idsForEnrollments, course.id)}">Enrolled</span>
                    <button th:if="${#lists.contains(idsForEnrollments, course.id) == false}" th:attr="onclick=|enroll(${course.id}, this)|">Enroll</button>
                </td>
            </tr>
        </tbody>
    </table>
    <h3>Your Enrolled Courses</h3>
    <ul>
        <li th:each="enrollment : ${enrollments}">
            <span th:text="${enrollment.course.title}"></span>
        </li>
    </ul>
    <a th:href="@{/}">Back to Home</a>
</body>
</html>
